<!DOCTYPE html>
<html>
<head>
  <title>2-Man Team Golf Scorecard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#317EFB"/>
  <style>
    body { font-family: Arial, sans-serif; padding: 10px; margin: 0; }
    table { border-collapse: collapse; width: 100%; overflow-x: auto; display: block; margin-bottom: 30px; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: center; font-size: 14px; }
    th { background: #f0f0f0; position: sticky; top: 0; z-index: 2; }
    input[type="number"], input[type="text"] { width: 50px; font-size: 14px; }
    label input { width: auto; margin: 2px; font-size: 14px; }
    .player-labels { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 15px; }
    .player-labels div { flex: 1 1 100%; max-width: 100%; }
    .player-labels input { width: 100%; box-sizing: border-box; }
    button { margin: 10px 5px 10px 0; padding: 10px; font-size: 14px; }
    .match-container { margin-bottom: 40px; border: 1px solid #ccc; padding: 10px; border-radius: 6px; }
    .match-nav { display: flex; flex-wrap: wrap; gap: 5px; margin: 10px 0; position: sticky; top: 0; background: #fff; z-index: 1; padding: 10px 0; }
    .match-nav button { flex: 1 1 auto; }
    @media (min-width: 500px) {
      .player-labels div { flex: 1 1 45%; }
    }
    @media (max-width: 768px) {
      table, thead, tbody, th, td, tr { display: block; }
      thead tr { display: none; }
      td { position: relative; padding-left: 50%; }
      td::before {
        position: absolute;
        top: 6px;
        left: 6px;
        width: 45%;
        white-space: nowrap;
        font-weight: bold;
      }
      td:nth-of-type(1)::before { content: "Hole"; }
      td:nth-of-type(2)::before { content: "Par"; }
      td:nth-of-type(3)::before { content: "Your"; }
      td:nth-of-type(4)::before { content: "Partner"; }
      td:nth-of-type(5)::before { content: "Team"; }
      td:nth-of-type(6)::before { content: "Birdie"; }
      td:nth-of-type(7)::before { content: "Opp1"; }
      td:nth-of-type(8)::before { content: "Opp2"; }
      td:nth-of-type(9)::before { content: "Opp Team"; }
      td:nth-of-type(10)::before { content: "Birdie"; }
    }
  </style>
</head>
<body>
  <h2>Your Scorecard</h2>
  <table>
    <thead>
      <tr><th>Hole</th><th>Your Score</th></tr>
    </thead>
    <tbody id="yourScorecard"></tbody>
  </table>

  <button onclick="addMatch()">Add New Match</button>
  <div class="match-nav" id="matchNav"></div>
  <div id="matches"></div>

  <script>
    const parValues = [4,5,3,4,4,4,4,3,5,4,5,4,4,3,5,3,4,4];
    const yourScorecard = document.getElementById("yourScorecard");
    for (let i = 1; i <= 18; i++) {
      const row = document.createElement("tr");
      row.id = `row_hole_${i}`;
      row.innerHTML = `<td>Hole ${i}</td><td><input type="number" min="1" id="your_${i}" onchange="handleYourScoreChange(${i})"></td>`;
      yourScorecard.appendChild(row);
    }

    function handleYourScoreChange(hole) {
      autoScrollToNext(hole);
      for (let m = 1; m <= matchCount; m++) {
        calcMatch(`match_${m}`, hole);
      }
    }

    function autoScrollToNext(currentHole) {
      if (currentHole < 18) {
        const nextInput = document.getElementById(`your_${currentHole + 1}`);
        if (nextInput) {
          nextInput.scrollIntoView({ behavior: "smooth", block: "center" });
          nextInput.focus();
        }
      }
    }

    let matchCount = 0;

    function addMatch() {
      matchCount++;
      const matchId = `match_${matchCount}`;

      const navButton = document.createElement('button');
      navButton.textContent = `Match ${matchCount}`;
      navButton.onclick = () => {
        document.querySelectorAll('.match-container').forEach(el => el.style.display = 'none');
        document.getElementById(matchId).style.display = 'block';
      };
      document.getElementById('matchNav').appendChild(navButton);

      const container = document.createElement('div');
      container.className = 'match-container';
      container.id = matchId;
      container.style.display = matchCount === 1 ? 'block' : 'none';
      container.innerHTML = `
        <h3>Match ${matchCount}</h3>
        <div class="player-labels">
          <div><label>Your Name: <input id="${matchId}_yourname" placeholder="Your Name"></label></div>
          <div><label>Partner Name: <input id="${matchId}_partner" placeholder="Partner"></label></div>
          <div><label>Opponent 1 Name: <input id="${matchId}_opp1" placeholder="Opponent 1"></label></div>
          <div><label>Opponent 2 Name: <input id="${matchId}_opp2" placeholder="Opponent 2"></label></div>
        </div>
        <table>
          <thead>
            <tr><th>Hole</th><th>Par</th><th>Your</th><th>Partner</th><th>Team</th><th>Birdie</th><th>Opp1</th><th>Opp2</th><th>Opp Team</th><th>Birdie</th></tr>
          </thead>
          <tbody>
            ${[...Array(18)].map((_, i) => `
              <tr>
                <td>Hole ${i+1}</td>
                <td>${parValues[i]}</td>
                <td id="${matchId}_your_${i+1}">-</td>
                <td><input type="number" min="1" id="${matchId}_partner_${i+1}" onchange="calcMatch('${matchId}', ${i+1})"></td>
                <td id="${matchId}_team_${i+1}">-</td>
                <td id="${matchId}_birdieA_${i+1}">-</td>
                <td><input type="number" min="1" id="${matchId}_opp1_${i+1}" onchange="calcMatch('${matchId}', ${i+1})"></td>
                <td><input type="number" min="1" id="${matchId}_opp2_${i+1}" onchange="calcMatch('${matchId}', ${i+1})"></td>
                <td id="${matchId}_oppTeam_${i+1}">-</td>
                <td id="${matchId}_birdieB_${i+1}">-</td>
              </tr>`).join('')}
          </tbody>
          <tfoot>
            <tr>
              <th>Total</th><td></td><td></td><td></td>
              <th id="${matchId}_totalA">0</th><th id="${matchId}_birdiesA">0</th>
              <td></td><td></td>
              <th id="${matchId}_totalB">0</th><th id="${matchId}_birdiesB">0</th>
            </tr>
          </tfoot>
        </table>
      `;
      document.getElementById('matches').appendChild(container);
    }

    function calcMatch(id, hole) {
      const par = parValues[hole - 1];
      const your = parseInt(document.getElementById(`your_${hole}`).value) || Infinity;
      const partner = parseInt(document.getElementById(`${id}_partner_${hole}`).value) || Infinity;
      const opp1 = parseInt(document.getElementById(`${id}_opp1_${hole}`).value) || Infinity;
      const opp2 = parseInt(document.getElementById(`${id}_opp2_${hole}`).value) || Infinity;

      document.getElementById(`${id}_your_${hole}`).innerText = your < Infinity ? your : '-';

      const team = Math.min(your, partner);
      const oppTeam = Math.min(opp1, opp2);

      document.getElementById(`${id}_team_${hole}`).innerText = team < Infinity ? team : '-';
      document.getElementById(`${id}_oppTeam_${hole}`).innerText = oppTeam < Infinity ? oppTeam : '-';

      document.getElementById(`${id}_birdieA_${hole}`).innerText = team < par ? '✔️' : '-';
      document.getElementById(`${id}_birdieB_${hole}`).innerText = oppTeam < par ? '✔️' : '-';

      let totalA = 0, totalB = 0, birdiesA = 0, birdiesB = 0;
      for (let i = 1; i <= 18; i++) {
        const a = parseInt(document.getElementById(`${id}_team_${i}`).innerText);
        const b = parseInt(document.getElementById(`${id}_oppTeam_${i}`).innerText);
        if (!isNaN(a)) {
          totalA += a;
          if (a < parValues[i - 1]) birdiesA++;
        }
        if (!isNaN(b)) {
          totalB += b;
          if (b < parValues[i - 1]) birdiesB++;
        }
      }
      document.getElementById(`${id}_totalA`).innerText = totalA;
      document.getElementById(`${id}_birdiesA`).innerText = birdiesA;
      document.getElementById(`${id}_totalB`).innerText = totalB;
      document.getElementById(`${id}_birdiesB`).innerText = birdiesB;
    }

    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js')
          .then(reg => console.log('Service worker registered.', reg))
          .catch(err => console.error('Service worker registration failed:', err));
      });
    }
  </script>
</body>
</html>
